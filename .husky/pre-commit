# VRP Enforcement - Zero tolerance for violations
echo "ğŸ” VRP Pre-Commit Checks..."

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# ğŸ›¡ï¸ WCCC PROTECTION - Block page-specific CSS files
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
if git diff --cached --name-only | grep -E 'src/app/.*/page\.css$'; then
  echo ""
  echo "â›” WCCC VIOLATION: page.css files are not allowed!"
  echo ""
  echo "Page-specific CSS files violate the 5-hub architecture."
  echo ""
  echo "Allowed CSS hubs:"
  echo "  â€¢ /styles/prebuilts.css (vr-* components)"
  echo "  â€¢ /styles/features.css (ft-* components)"
  echo "  â€¢ /styles/layout.css (ly-* shell + layouts)"
  echo ""
  echo "If you need custom styling:"
  echo "  1. Check if a prebuilt variant exists"
  echo "  2. Create new prebuilt variant in /src/prebuilts/"
  echo "  3. Last resort: Create feature component in /src/features/"
  echo ""
  echo "See TTT-WCCC-PROTOCOL.md for architectural rationale."
  echo ""
  echo "Commit blocked."
  exit 1
fi

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# ğŸ”’ SACRED CONFIG PROTECTION - Block unauthorized ESLint changes
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
if git diff --cached --name-only | grep -q "^eslint.config.mjs$"; then
  echo ""
  echo "â›” CRITICAL: eslint.config.mjs modification detected!"
  echo ""
  echo "This file contains the VIRGIN EXCEPTION LIST."
  echo "Changes to ESLint rules or exceptions require explicit approval."
  echo ""
  echo "If you are:"
  echo "  - Fixing a legitimate bug: FIX THE CODE, not the rule"
  echo "  - Adding an exception: STOP. Discuss first."
  echo "  - Ken approving this: Override with --no-verify"
  echo ""
  echo "Commit blocked. No exceptions without discussion."
  exit 1
fi

# Run critical VRP scripts (manifest validation skipped - legacy routes not yet in SMAC manifests)
npm run vrp:isv || exit 1
npm run vrp:naming || exit 1

# Run lint-staged for TypeScript/ESLint checks
npx lint-staged
